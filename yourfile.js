const WebSocket = require("ws");

// Create an array of random numbers
const randomNumbers = [
  112.54, 113.21, 112.89, 113.45, 114.02, 113.78, 114.23, 114.87, 115.12,
  115.68, 115.34, 115.98, 116.43, 116.79, 117.32, 117.89, 118.25, 118.91,
  119.36, 119.82, 120.17, 120.73, 121.28, 121.84, 122.19, 122.75, 123.21,
  123.66, 124.02, 124.58, 125.03, 125.49, 126.04, 126.5, 127.16, 127.71, 128.07,
  128.63, 129.08, 129.44, 130.09, 130.54, 131.1, 131.66, 132.21, 132.67, 133.12,
  133.58, 134.24, 134.79, 135.15, 135.8, 136.36, 136.91, 137.27, 137.82, 138.18,
  138.83, 139.29, 139.84, 140.2, 140.85, 141.31, 141.86, 142.22, 142.77, 143.13,
  143.68, 144.24, 144.79, 145.15, 145.7, 146.06, 146.61, 147.17, 147.72, 148.08,
  148.63, 149.19, 149.74, 150.1, 150.65, 151.01, 151.56, 152.12, 152.67, 153.03,
  153.58, 154.14, 154.69, 155.05, 155.6, 156.16, 156.71, 157.07, 157.62, 158.08,
  158.63, 159.29, 159.84, 160.2, 160.85, 161.31, 161.86, 162.22, 162.77, 163.13,
  163.68, 164.24, 164.79, 165.15, 165.8, 166.36, 166.91, 167.27, 167.82, 168.18,
  168.83, 169.29, 169.84, 170.2, 170.85, 171.31, 171.86, 172.22, 172.77, 173.13,
  173.68, 174.24, 174.79, 175.15, 175.8, 176.36, 176.91, 177.27, 177.82, 178.18,
  178.83, 179.29, 179.84, 180.2, 180.85, 181.31, 181.86, 182.22, 182.77, 183.13,
  183.68, 184.24, 184.79, 185.15, 185.8, 186.36, 186.91, 187.27, 187.82, 188.18,
  188.83, 189.29, 189.84, 190.2, 190.85, 191.31, 191.86, 192.22, 192.77, 193.13,
  193.68, 194.24, 194.79, 195.15, 195.8, 196.36, 196.91, 197.27, 197.82, 198.18,
  198.83, 199.29, 199.84, 200.2, 200.85, 201.31, 201.86, 202.22, 202.77, 203.13,
  203.68, 204.24, 204.79, 205.15, 205.8, 206.36, 206.91, 207.27, 207.82, 208.18,
  208.83, 209.29, 209.84, 210.2, 210.85, 211.31, 211.86, 212.22, 212.77, 213.13,
  213.68, 214.24, 214.79, 215.15, 215.8, 216.36, 216.91, 217.27, 217.82, 218.18,
  218.83, 219.29, 219.84, 220.2, 220.85, 221.31, 221.86, 222.22, 222.77, 223.13,
  223.68, 224.24, 224.79, 225.15, 225.8, 226.36, 226.91, 227.27, 227.82, 228.18,
  228.83, 229.29, 229.84, 230.2, 230.85, 231.31, 231.86, 232.22, 232.77, 233.13,
  233.68, 234.24, 234.79, 235.15, 235.8, 236.36, 236.91, 237.27, 237.82, 238.18,
  238.83, 239.29, 239.84, 240.2, 240.85, 241.31, 241.86, 242.22, 242.77, 243.13,
  243.68, 244.24, 244.79, 245.15, 245.8, 246.36, 246.91, 247.27, 247.82, 248.18,
  248.83, 249.29, 249.84, 250.2, 250.85, 251.31, 251.86, 252.22, 252.77, 253.13,
  253.68, 254.24, 254.79, 255.15, 255.8, 256.36, 256.91, 257.27, 257.82, 258.18,
  258.83, 259.29, 259.84, 260.2, 260.85, 261.31, 261.86, 262.22, 262.77, 263.13,
  263.68, 264.24, 264.79, 265.15, 265.8, 266.36, 266.91, 267.27, 267.82, 268.18,
  268.83, 269.29, 269.84, 270.2, 270.85, 271.31, 271.86, 272.22, 272.77, 273.13,
  273.68, 274.24, 274.79, 275.15, 275.8, 276.36, 276.91, 277.27, 277.82, 278.18,
  278.83, 279.29, 279.84, 280.2, 280.85, 281.31, 281.86, 282.22, 282.77, 283.13,
  283.68, 284.24, 284.79, 285.15, 285.8, 286.36, 286.91, 287.27, 287.82, 288.18,
  288.83, 289.29, 289.84, 290.2, 290.85, 291.31, 291.86, 292.22, 292.77, 293.13,
  293.68, 294.24, 294.79, 295.15, 295.8, 296.36, 296.91, 297.27, 297.82, 298.18,
  298,
];

const wss = new WebSocket.Server({ port: 8080 });
const sendRandomNumbers = (ws) => {
  const interval = setInterval(() => {
    const randomNumber =
      randomNumbers[Math.floor(Math.random() * randomNumbers.length)];
    const test = {
      OI: 0,
      OIChngPer: 0,
      ttv: 0,
      atp: 0,
      chng: 0,
      chngPer: 0,
      close: 0,
      high: 0,
      lcl: 0,
      low: 0,
      ltp: randomNumber,
      ltq: 0,
      ltt: 0,
      open: 0,
      symbol: 0,
      ucl: 0,
      vol: 0,
      yHigh: 0,
      yLow: 0,
      askPrice: 0,
      bidPrice: 0,
    };
    ws.send(JSON.stringify(test));
  }, 1000);

  ws.on("close", () => {
    clearInterval(interval);
  });
};

wss.on("connection", (ws) => {
  console.log("Client connected");

  sendRandomNumbers(ws);

  ws.on("close", () => {
    console.log("Client disconnected");
  });
});
